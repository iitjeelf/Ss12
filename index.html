<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>LFJC Online Exam</title>
<style>
/* === DESIGN KEPT EXACTLY AS REQUESTED === */
body{font-family:"SF Pro Display",Arial,sans-serif;margin:0;background:#fff;color:#000;}
header{background:linear-gradient(145deg,#E6E6FA,#D8BFD8);color:#4B0082;text-align:center;padding:20px;font-size:36px;font-weight:700;letter-spacing:1.5px;box-shadow:0 5px #aaa;text-shadow:0 1px 2px #fff;}
#studentEntry,#examArea{padding:20px;text-align:center;}
.form-group{display:flex;flex-direction:row;align-items:center;justify-content:center;margin-bottom:15px;}
.form-group label{font-size:1.15rem;font-weight:600;margin-right:10px;color:#4B0082;width:120px;text-align:right;}
input[type="text"]{padding:10px 12px;font-size:1.1rem;border-radius:10px;border:1.5px solid #4B0082;outline:none;min-width:250px;}
input.error{animation:glowRed 0.5s alternate infinite;border-color:red;}
@keyframes glowRed{0%{box-shadow:0 0 5px red;}100%{box-shadow:0 0 15px red;}}
button{position:relative;overflow:hidden;cursor:pointer;border:none;border-radius:12px;transition:all .18s ease;box-shadow:0 6px #aaa;background:linear-gradient(to bottom,#fafaff,#dcd6f7);color:#4B0082;font-weight:600;padding:10px 20px;font-size:18px;}
button:hover{transform:translateY(-2px);box-shadow:0 8px 15px rgba(0,0,0,.28);}
button:active{transform:translateY(3px) scale(.98);}
.optBtn{font-size:16px;padding:8px 18px;margin:6px;border:2px solid #4B0082;background:#fff;border-radius:8px;box-shadow:0 5px #aaa;}
.optBtn.selected{background:#32CD32;color:#fff;border-color:#2fa92f;}
.navContainer{display:flex;justify-content:center;gap:10px;margin:10px 0;flex-wrap:wrap}
.navBtn{font-size:16px;padding:10px 20px;border-radius:8px;color:#fff;font-weight:bold;cursor:pointer;background:linear-gradient(145deg,#1E90FF,#4682B4);}
#markReviewBtn{background:linear-gradient(145deg,#ffb84d,#ff9900)}
#submitBtn{background:linear-gradient(145deg,#c8b88a,#b49e60)}
#timerEl{font-size:20px;font-weight:bold;color:#4B0082;padding:6px 12px;border-radius:6px;background:#f0f0ff;display:inline-block;transition: all 0.3s ease;}
#timerEl.blink{animation:blinkTimer 1s infinite;}
@keyframes blinkTimer{0%{background:#ff6666;color:#fff;}50%{background:#fff;color:#4B0082;}100%{background:#ff6666;color:#fff;}}
#paletteContainer button{width:36px;height:36px;border-radius:50%;font-size:14px;margin:3px;border:1px solid #4B0082;background:#E6E6FA;color:#4B0082;}
#paletteContainer button.selected{background:#32CD32;color:#fff;border-color:#2fa92f}
#paletteContainer button.reviewed{background:yellow;color:#000}
#paletteContainer button.current{border:3px solid red}
footer{background:#E6E6FA;color:#4B0082;padding:10px;text-align:center;font-weight:bold;position:fixed;width:100%;bottom:0;}
.sectionTitle{font-size:22px;color:#4B0082;font-weight:bold;margin-bottom:8px;}
img.questionImg{max-width:100%;border-radius:10px;transition: transform 0.3s ease; cursor:zoom-in;}
img.questionImg:hover{transform:scale(1.4);}
.glow {
  animation: glowPulse 1.6s infinite alternate;
  box-shadow:0 8px 18px rgba(75,0,130,0.12);
}
@keyframes glowPulse {
  0% { box-shadow:0 6px 10px rgba(75,0,130,0.06); transform:translateY(0); }
  50% { box-shadow:0 12px 30px rgba(75,0,130,0.14); transform:translateY(-2px); }
  100% { box-shadow:0 6px 10px rgba(75,0,130,0.06); transform:translateY(0); }
}
#fullRedOverlay{ position:fixed; left:0; top:0; width:100%; height:100%; display:none; z-index:9999; pointer-events:auto; }
#fullRedOverlay .overlay-slice{ position:absolute; top:0; bottom:0; width:calc(100%/7); height:100%; background:red; left:0; transition:opacity .45s ease, transform .45s ease; }
#accessDeniedBox{ position:fixed; left:50%; top:40%; transform:translate(-50%,-50%); z-index:10000; color:#fff; text-align:center; display:none; pointer-events:auto; }
#accessDeniedBox h1{ font-size:48px; font-weight:900; margin:0 0 18px 0; color:#fff; text-shadow:0 2px 6px rgba(0,0,0,0.4); }
#callAdminBtn{ padding:12px 22px; border-radius:12px; font-weight:800; background:green; color:#fff;}
#callAdminBtn.glow { /* keep glow */ }
@media(max-width:600px){ #accessDeniedBox h1{font-size:28px;} #callAdminBtn{padding:10px 14px;} .form-group{flex-direction:column;align-items:flex-start;} .form-group label{text-align:left;width:auto;margin-bottom:5px;} }
</style>
</head>
<body>
<header>LFJC ONLINE EXAMINATION</header>

<div id="studentEntry">
  <div class="form-group"><label>Name</label><input type="text" id="stuName" placeholder="Only letters & spaces" autocomplete="off" autocapitalize="words"></div>
  <div class="form-group"><label>Section</label><input type="text" id="stuSection" placeholder="Letters & digits" autocomplete="off"></div>
  <div class="form-group"><label>Roll</label><input type="text" id="stuRoll" placeholder="Digits only" autocomplete="off"></div>
  <div class="form-group"><label>Admission No</label><input type="text" id="stuAdm" placeholder="Digits only" autocomplete="off"></div>
  <div class="form-group"><button id="stuStartBtn" style="display:none;">Start Exam</button></div>
  <p id="studentMsg"></p>
</div>

<div id="examArea" style="display:none;">
  <div id="examHeader" style="display:flex;justify-content:space-between;align-items:center;">
    <div id="stuInfo" style="text-align:left;font-weight:bold;"></div>
    <div id="stuQInfo" style="text-align:center;"></div>
    <div id="timerEl">ðŸ•’ 00:00</div>
  </div>

  <div id="questionContainer" style="text-align:center;margin-top:10px;"></div>

  <div class="navContainer">
    <button class="navBtn" id="prevBtn">â¬… Previous</button>
    <button class="navBtn" id="markReviewBtn">Review</button>
    <button class="navBtn" id="nextBtn">Next âž¡</button>
    <button class="navBtn" id="submitBtn">Submit Exam</button>
  </div>

  <div id="paletteContainer"></div>
</div>

<footer>LFJC@2025 All rights reserved</footer>

<div id="fullRedOverlay" aria-hidden="true"></div>
<div id="accessDeniedBox" aria-hidden="true">
  <h1 id="accessDeniedText">ACCESS DENIED</h1>
  <div>
    <button id="callAdminBtn" class="glow">CALL ADMIN</button>
  </div>
</div>

<script>
// ===== CONFIG =====
const MARK_PER_CORRECT = 1;      
const MARK_PER_WRONG = -0.25;   
let images = ["1.png","2.png","3.png","4.png","5.png","6.png"];
let answerKey = ["A","B","C","D","A","B"];
const subjects = ["Maths","Physics","Chemistry"];
let examData = { files: [], subjectNames: [], keys: [] };
let progress = null, timerInterval = null, pendingAttempt = null;
const LS_KEY = 'lfjc_attempts_v1';
const ADMIN_PASSWORD = 'lfjc2025';
let SLICE_COUNT = ADMIN_PASSWORD.length;

// ====== HELPERS ======
function shuffleArray(arr){const copy = arr.slice();for(let i=copy.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[copy[i],copy[j]]=[copy[j],copy[i]];}return copy;}
function makeStudentIdRaw(name,sec,roll,adm){return `${name.trim().toLowerCase()}|${sec.trim().toLowerCase()}|${roll.trim()}|${adm.trim()}`;}
function storeAttemptLocal(student){try{const raw = makeStudentIdRaw(student.name, student.sec, student.roll, student.adm); const attempts=JSON.parse(localStorage.getItem(LS_KEY)||'[]'); attempts.push({raw,t:Date.now()}); localStorage.setItem(LS_KEY, JSON.stringify(attempts));}catch(e){}}
function isBlockedByPrevious(name,sec,roll,adm){try{const attempts=JSON.parse(localStorage.getItem(LS_KEY)||'[]'); const cutoff=Date.now()-(24*60*60*1000); for(let a of attempts){if(a.t<cutoff) continue; const parts=(a.raw||'').split('|'); if(parts.length<4) continue; const [sn,ss,sr,sa]=parts; let matches=0; if(sn&&name.toLowerCase().trim()===sn) matches++; if(ss&&sec.toLowerCase().trim()===ss) matches++; if(sr&&roll.trim()===sr) matches++; if(sa&&adm.trim()===sa) matches++; if(matches>=2) return true;}}catch(e){} return false;}

// ====== PREPARE EXAM ======
function prepareExamData(){
  examData.files=[];examData.subjectNames=[];examData.keys=[];
  const total=images.length;
  const base=Math.floor(total/3);
  let remainder=total%3; let start=0; const groups=[];
  for(let s=0;s<3;s++){
    const count=base+(remainder>0?1:0); remainder--;
    const groupImgs=images.slice(start,start+count); const groupKeys=answerKey.slice(start,start+count);
    start+=count;
    const idxs=Array.from({length:groupImgs.length},(_,i)=>i);
    const shuffledIdxs=shuffleArray(idxs);
    const shuffledImgs=shuffledIdxs.map(i=>groupImgs[i]); const shuffledKeys=shuffledIdxs.map(i=>groupKeys[i]);
    groups.push({name:subjects[s], imgs:shuffledImgs, keys:shuffledKeys});
  }
  const shuffledGroups=shuffleArray(groups);
  shuffledGroups.forEach(g=>{g.imgs.forEach((img,i)=>{examData.files.push(img); examData.keys.push(g.keys[i]); examData.subjectNames.push(g.name);});});
}

// ====== VALIDATION ======
function validateStudentInputs(){
  const name=document.getElementById('stuName'), sec=document.getElementById('stuSection'), roll=document.getElementById('stuRoll'), adm=document.getElementById('stuAdm');
  let validName=/^[A-Za-z .]+$/.test(name.value);
  let validSec=/^[A-Za-z0-9]+$/.test(sec.value);
  let validRoll=/^[0-9]+$/.test(roll.value);
  let validAdm=/^[0-9]+$/.test(adm.value);
  name.classList.toggle('error',!validName&&name.value!=="");
  sec.classList.toggle('error',!validSec&&sec.value!=="");
  roll.classList.toggle('error',!validRoll&&roll.value!=="");
  adm.classList.toggle('error',!validAdm&&adm.value!=="");
  const allValid=validName&&validSec&&validRoll&&validAdm;
  const startBtn=document.getElementById('stuStartBtn');
  startBtn.style.display=allValid?'inline-block':'none';
  allValid?startBtn.classList.add('glow'):startBtn.classList.remove('glow');
  return allValid;
}
['stuName','stuSection','stuRoll','stuAdm'].forEach(id=>document.getElementById(id).addEventListener('input',validateStudentInputs));

// ====== START EXAM ======
document.getElementById('stuStartBtn').onclick=()=>{
  if(!validateStudentInputs()) return;
  const name=document.getElementById('stuName').value.trim(), sec=document.getElementById('stuSection').value.trim(), roll=document.getElementById('stuRoll').value.trim(), adm=document.getElementById('stuAdm').value.trim();
  pendingAttempt={name, sec, roll, adm};
  if(isBlockedByPrevious(name,sec,roll,adm)){document.getElementById('stuName').value='';document.getElementById('stuSection').value='';document.getElementById('stuRoll').value='';document.getElementById('stuAdm').value='';document.getElementById('stuStartBtn').style.display='none';document.getElementById('stuStartBtn').classList.remove('glow'); showRedOverlay(); return;}
  if(!confirm("Are you sure you want to START the exam? Once started, timer will begin.")) { pendingAttempt=null; return;}
  document.getElementById('stuName').value='';document.getElementById('stuSection').value='';document.getElementById('stuRoll').value='';document.getElementById('stuAdm').value='';document.getElementById('stuStartBtn').style.display='none';document.getElementById('stuStartBtn').classList.remove('glow');
  prepareExamData();
  progress={answers:Array(examData.files.length).fill(null), review:Array(examData.files.length).fill(false), currentIndex:0, student:{name,sec,roll,adm,date:new Date().toLocaleDateString()}, timeLeftSec:5*60};
  document.getElementById('studentEntry').style.display='none';
  document.getElementById('examArea').style.display='block';
  renderQuestion(); renderPalette(); startTimer();
};

// ====== RED OVERLAY & ADMIN CALL ======
function showRedOverlay(){
  const overlay=document.getElementById('fullRedOverlay'); overlay.innerHTML=''; const w=100/SLICE_COUNT;
  for(let i=0;i<SLICE_COUNT;i++){ const s=document.createElement('div'); s.className='overlay-slice'; s.style.left=(i*w)+'%'; s.style.width=w+'%'; s.dataset.index=i; overlay.appendChild(s);}
  overlay.style.display='block';
  const box=document.getElementById('accessDeniedBox'); box.style.display='block';
  const t=document.getElementById('accessDeniedText'); t.style.animation='blinkTimer 1s infinite';
  const callBtn=document.getElementById('callAdminBtn'); callBtn.classList.add('glow');
  document.getElementById('studentEntry').style.pointerEvents='none';
  document.getElementById('examArea').style.pointerEvents='none';
}
let adminTypingActive=false, adminProgress=0;
document.getElementById('callAdminBtn').addEventListener('click',()=>{adminTypingActive=true; adminProgress=0; window.focus();});
window.addEventListener('keydown',(e)=>{if(!adminTypingActive) return; const ch=e.key; if(e.ctrlKey||e.altKey||e.metaKey) return; const expected=ADMIN_PASSWORD[adminProgress]; if(!expected) return; if(ch===expected){ const overlay=document.getElementById('fullRedOverlay'); const slices=Array.from(overlay.querySelectorAll('.overlay-slice')); if(slices[adminProgress]){ slices[adminProgress].style.opacity='0'; slices[adminProgress].style.transform='translateX(-10px)'; } adminProgress++; if(adminProgress>=SLICE_COUNT){ adminTypingActive=false; setTimeout(()=>{document.getElementById('fullRedOverlay').style.display='none'; document.getElementById('accessDeniedBox').style.display='none'; document.getElementById('studentEntry').style.pointerEvents=''; document.getElementById('examArea').style.pointerEvents=''; document.getElementById('callAdminBtn').classList.remove('glow'); if(pendingAttempt){prepareExamData(); progress={answers:Array(examData.files.length).fill(null), review:Array(examData.files.length).fill(false), currentIndex:0, student:{name:pendingAttempt.name,sec:pendingAttempt.sec,roll:pendingAttempt.roll,adm:pendingAttempt.adm,date:new Date().toLocaleDateString()}, timeLeftSec:5*60}; pendingAttempt=null; document.getElementById('studentEntry').style.display='none'; document.getElementById('examArea').style.display='block'; renderQuestion(); renderPalette(); startTimer(); }},480); } }});

// ====== TIMER & RENDER ======
function startTimer(){const timerEl=document.getElementById('timerEl'); const stuInfo=document.getElementById('stuInfo'); const stuQInfo=document.getElementById('stuQInfo'); timerInterval=setInterval(()=>{ if(progress.timeLeftSec<=0){clearInterval(timerInterval); submitExam(); return;} let m=Math.floor(progress.timeLeftSec/60); let s=progress.timeLeftSec%60; timerEl.textContent=`ðŸ•’ ${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`; if(progress.timeLeftSec<=60){timerEl.classList.add('blink');} progress.timeLeftSec--; stuInfo.textContent=`Name: ${progress.student.name} | Section: ${progress.student.sec} | Roll: ${progress.student.roll}`; stuQInfo.textContent=`Q${progress.currentIndex+1} of ${examData.files.length}`;},1000);}
function renderQuestion(){const qC=document.getElementById('questionContainer'); qC.innerHTML=''; const idx=progress.currentIndex; const img=document.createElement('img'); img.src=examData.files[idx]; img.className='questionImg glow'; qC.appendChild(img); const opts=['A','B','C','D']; opts.forEach(o=>{ const b=document.createElement('button'); b.textContent=o; b.className='optBtn'; if(progress.answers[idx]===o)b.classList.add('selected'); b.onclick=()=>{progress.answers[idx]=o; renderPalette(); renderQuestion();}; qC.appendChild(b); });}
function renderPalette(){const pal=document.getElementById('paletteContainer'); pal.innerHTML=''; examData.files.forEach((f,i)=>{ const b=document.createElement('button'); b.textContent=i+1; if(progress.answers[i]) b.classList.add('selected'); if(progress.review[i]) b.classList.add('reviewed'); if(progress.currentIndex===i)b.classList.add('current'); b.onclick=()=>{progress.currentIndex=i; renderQuestion(); renderPalette();}; pal.appendChild(b);});}

// ====== NAV BUTTONS ======
document.getElementById('prevBtn').onclick=()=>{if(progress.currentIndex>0) progress.currentIndex--; renderQuestion(); renderPalette();}
document.getElementById('nextBtn').onclick=()=>{if(progress.currentIndex<examData.files.length-1) progress.currentIndex++; renderQuestion(); renderPalette();}
document.getElementById('markReviewBtn').onclick=()=>{progress.review[progress.currentIndex]=!progress.review[progress.currentIndex]; renderPalette();}

// ====== SUBMIT ======
document.getElementById('submitBtn').onclick=()=>{
  if(confirm("Are you sure you want to submit your exam?")) submitExam();
};

function submitExam(){
  clearInterval(timerInterval);
  let correct=0,wrong=0,blank=0;
  for(let i=0;i<examData.files.length;i++){
    const given=progress.answers[i], key=answerKey[i];
    if(!given) blank++;
    else if(given===key) correct++;
    else wrong++;
  }
  const total=examData.files.length, marks=correct - wrong*0.25;
  storeAttemptLocal(progress.student);

  document.getElementById('examArea').style.display='none';
  document.getElementById('studentEntry').style.display='none';

  const r=document.createElement('div'); r.id='resultArea'; r.style.padding='20px'; r.style.textAlign='center';
  r.innerHTML=`<h2>Congratulations ${progress.student.name}!</h2>
  <p>Section: ${progress.student.sec} | Roll: ${progress.student.roll} | Admission No: ${progress.student.adm}</p>
  <p>Correct: ${correct} | Wrong: ${wrong} | Blank: ${blank} | Total: ${total} | Score: ${marks.toFixed(2)}</p>
  <button id="logoutBtn">Logout</button>`;
  document.body.appendChild(r);
  document.getElementById('logoutBtn').onclick=()=>window.close();
}
</script>
</body>
</html>
